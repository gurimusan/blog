<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Post-rsses on gurimusan blog</title>
    <link>https://gurimusan.github.io/blog/post/index.xml</link>
    <description>Recent content in Post-rsses on gurimusan blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <lastBuildDate>Tue, 08 Nov 2016 18:35:06 +0900</lastBuildDate>
    <atom:link href="https://gurimusan.github.io/blog/post/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>ansibleでEC2インスタンスを作成する</title>
      <link>https://gurimusan.github.io/blog/post/how-to-create-ec2-instance-use-ansible/</link>
      <pubDate>Tue, 08 Nov 2016 18:35:06 +0900</pubDate>
      
      <guid>https://gurimusan.github.io/blog/post/how-to-create-ec2-instance-use-ansible/</guid>
      <description>

&lt;h1 id=&#34;やったこと&#34;&gt;やったこと&lt;/h1&gt;

&lt;p&gt;ansibleを使って、aws ec2インスタンスを作成する。&lt;/p&gt;

&lt;h1 id=&#34;実行環境&#34;&gt;実行環境&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Mac OS X El Capitan 10.11.6&lt;/li&gt;
&lt;li&gt;python 2.7.12&lt;/li&gt;
&lt;li&gt;ansible 2.2.0.0&lt;/li&gt;
&lt;li&gt;boto 2.43.0&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;事前に必要なこと-及び必要なツール&#34;&gt;事前に必要なこと、及び必要なツール&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;aws上のVPCの構築&lt;/li&gt;
&lt;li&gt;IAMユーザ、及びアクセスキー・シークレットキーの入手&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/yyuu/pyenv&#34;&gt;pyenv&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/direnv/direnv&#34;&gt;direnv&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;ディレクトリ構成&#34;&gt;ディレクトリ構成&lt;/h1&gt;

&lt;pre&gt;&lt;code&gt;.
├── .envrc
├── .python-version
├── hosts
│   └── development
│       ├── ec2.ini
│       ├── ec2.py
│       ├── inventry
│       └── group_vars
│           └── all.yml
├── roles
│   └── ec2
│       └── tasks
│           ├── instance.yml
│           ├── keypair.yml
│           ├── main.yml
│           └── security_group.yml
└── ec2.yml(プレイブック)
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;direnv&#34;&gt;direnv&lt;/h1&gt;

&lt;p&gt;適用なディレクトリを作って、下記を実行し、環境変数にAWSのAPI用の接続情報を設定する。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ (
echo &#39;export AWS_ACCESS_KEY_ID=&amp;lt;アクセスキー&amp;gt;&#39;
echo &#39;export AWS_SECRET_ACCESS_KEY=&amp;lt;シークレットキー&amp;gt;&#39;
) &amp;gt; .envrc
$ direnv allow
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;python&#34;&gt;python&lt;/h1&gt;

&lt;p&gt;pyenv使ってpythonのインストール、2.7系ならなんでも良い。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ pyenv install 2.7.12
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;上記で作ったディレクトリに移動した時に、特定のpython環境を使うように設定する。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ pyenv virtualenv 2.7.12 example_cm_py_27_12
$ echo &#39;example_cm_py_27_12&#39; &amp;gt; .python-version
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;boto と ansibleをインストールする。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ pip install boto==2.43.0
$ pip install ansible==2.2.0.0
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;ec2用のdynamic-inventory-ファイルを入手する&#34;&gt;EC2用のdynamic inventory ファイルを入手する&lt;/h1&gt;

&lt;p&gt;「&lt;a href=&#34;http://docs.ansible.com/ansible/intro_dynamic_inventory.html#example-aws-ec2-external-inventory-script&#34;&gt;Example: AWS EC2 External Inventory Script&lt;/a&gt;」から&lt;a href=&#34;https://raw.githubusercontent.com/ansible/ansible/devel/contrib/inventory/ec2.py&#34;&gt;ec2.py&lt;/a&gt;と&lt;a href=&#34;https://raw.githubusercontent.com/ansible/ansible/devel/contrib/inventory/ec2.ini&#34;&gt;ec2.ini&lt;/a&gt;を入手して、「hosts/development」配下に配置する。&lt;/p&gt;

&lt;p&gt;「ec2.py」には、実行権限を付与する。&lt;/p&gt;

&lt;h1 id=&#34;プレイブックを作成する&#34;&gt;プレイブックを作成する&lt;/h1&gt;

&lt;p&gt;「ec2.yml」というファイル名でプレイブックを作成する。※ファイル名はなんでも良い。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;---
- hosts: localhost
  connection: local
  gather_facts: False
  roles:
    - role: ec2

- hosts: launched_{group_name}
  remote_user: ec2-user
  gather_facts: no
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;イベントリファイルを作成する&#34;&gt;イベントリファイルを作成する&lt;/h1&gt;

&lt;p&gt;「hosts/development」配下に「inventry」というファイルを作成する。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[localhost]
localhost ansible_python_interpreter=~/.pyenv/shims/python
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;イベントリ用の変数定義を行うために、「hosts/development/group_vars」というディレクトリを作成し、「hosts/development/group_vars/all.yml」に下記の変数定義を行う。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;aws:
  # key pair to use on the instance
  keypair_name: example_development
  # security group name, and instance tag name.
  group_name: example_development
  # リージョン
  region: ap-northeast-1
  # Amazon linux の最新のディスクイメージ
  ec2_image: ami-cbf90ecb
  # EC2 のインスタンスタイプ
  ec2_instance_type: t2.micro
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;ec2ロールの作成&#34;&gt;EC2ロールの作成&lt;/h1&gt;

&lt;p&gt;roles/ec2/tasks/main.yml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;---
- include: keypair.yml
- include: security_group.yml
- include: instance.yml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;roles/ec2/tasks/kyepair.yml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;---
- name: Create EC2 keypair.
  ec2_key:
    # Name of the key pair.
    name: &amp;quot;{{ aws.keypair_name }}&amp;quot;
    # The AWS region to use.
    region: &amp;quot;{{ aws.region }}&amp;quot;
  register: ec2_keypair

- name: Create keypair file.
  file:
    path=~/.ssh/{{ ec2_keypair.key.name }}.pem
    state=touch
    mode=0600
  when: ec2_keypair.key.private_key is defined

- name: Write keypair to file.
  local_action: shell echo &amp;quot;{{ ec2_keypair.key.private_key }}&amp;quot; &amp;gt; ~/.ssh/{{ ec2_keypair.key.name }}.pem
  when: ec2_keypair.key.private_key is defined
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;roles/ec2/tasks/security_group.yml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;---
- name: Create EC2 Security Group.
  ec2_group:
    # Name of the security group.
    name: &amp;quot;{{ aws.group_name }}&amp;quot;
    # Description of the security group.
    description: &amp;quot;{{ aws.group_name }} server security group&amp;quot;
    # The AWS region to use.
    region: &amp;quot;{{ aws.region }}&amp;quot;

    # Inbound.
    rules:
      - proto: tcp
        from_port: 80
        to_port: 80
        cidr_ip: 0.0.0.0/0
      - proto: tcp
        from_port: 443
        to_port: 443
        cidr_ip: 0.0.0.0/0
      - proto: tcp
        from_port: 22
        to_port: 22
        cidr_ip: 0.0.0.0/0
      - proto: icmp
        from_port: -1 # icmp type, -1 = any type
        to_port: -1 # icmp subtype, -1 = any subtype
        cidr_ip: 10.0.0.0/0

    # Outbound.
    rules_egress:
      - proto: all
        from_port: 0
        to_port: 65535
        cidr_ip: 0.0.0.0/0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;roles/ec2/tasks/instance.yml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;---
- name: Create EC2 instance.
  ec2:
    # ami ID to use for the instance.
    image: &amp;quot;{{ aws.ec2_image }}&amp;quot;
    # instance type to use for the instance.
    instance_type: &amp;quot;{{ aws.ec2_instance_type }}&amp;quot;
    # The AWS region to use.
    region: &amp;quot;{{ aws.region }}&amp;quot;
    # key pair to use on the instance
    key_name: &amp;quot;{{ aws.keypair_name }}&amp;quot;
    # security group (or list of groups) to use with the instance.
    group: &amp;quot;{{ aws.group_name }}&amp;quot;
    instance_tags:
      Name: &amp;quot;{{ aws.group_name }}&amp;quot;
    wait: yes
    wait_timeout: 300
  register: ec2

- name: Add new instance to host group
  add_host: hostname={{ item.public_ip }} groupname=&amp;quot;launched_{{aws.group_name}}&amp;quot;
  with_items: &#39;{{ec2.instances}}&#39;

- name: Wait for SSH to come up
  wait_for: host={{ item.public_dns_name }} port=22 delay=60 timeout=320 state=started
  with_items: &#39;{{ec2.instances}}&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;実行&#34;&gt;実行&lt;/h1&gt;

&lt;pre&gt;&lt;code&gt;$ ansible-playbook -i hosts/development ec2.yml
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;参考にしたサイト&#34;&gt;参考にしたサイト&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.ansible.com/ansible/ec2_module.html&#34;&gt;ec2 - create, terminate, start or stop an instance in ec2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.ansible.com/ansible/ec2_group_module.html&#34;&gt;ec2_group - maintain an ec2 VPC security group.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.ansible.com/ansible/ec2_key_module.html&#34;&gt;ec2_key - maintain an ec2 key pair.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Raspberry PI で、ADCを使って温度を測定する</title>
      <link>https://gurimusan.github.io/blog/post/raspberry-pi-how-to-measuring-temperature-using-adc/</link>
      <pubDate>Thu, 29 Sep 2016 23:52:56 +0900</pubDate>
      
      <guid>https://gurimusan.github.io/blog/post/raspberry-pi-how-to-measuring-temperature-using-adc/</guid>
      <description>

&lt;h1 id=&#34;やりたいこと&#34;&gt;やりたいこと&lt;/h1&gt;

&lt;p&gt;アナログ温度センサを使って、Raspberry PIで測る。&lt;/p&gt;

&lt;h1 id=&#34;使用する機器-及び部品&#34;&gt;使用する機器、及び部品&lt;/h1&gt;

&lt;p&gt;温度センサは MCP9700を利用する。&lt;/p&gt;

&lt;p&gt;MCP9700はアナログセンサで、Raspberry PI のピンはデジタルな入力しかできないので、アナログ-デジタル変換を行うために、ADコンバータ MCP3008を利用する。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Raspberry PI3 Model B&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://akizukidenshi.com/catalog/g/gI-03286/&#34;&gt;温度センサ MCP9700&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://akizukidenshi.com/catalog/g/gI-09485/&#34;&gt;ADコンバータ MCP3008&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://akizukidenshi.com/catalog/g/gP-00315/&#34;&gt;ブレッドボード EIC-801&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ジャンパワイア&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;raspberry-piでspiをセットアッフ-する&#34;&gt;Raspberry PiでSPIをセットアップする&lt;/h1&gt;

&lt;p&gt;MCP3008は、SPIバスで接続する必要があるため、Raspberry PI のSPIを有効にする。&lt;/p&gt;

&lt;p&gt;下記コマンドを実行。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo raspi-config
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Advanced Optionsで A6 SPIを選択して、下記の両方で Yes を選択。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;SPI interface to be enabled?&lt;/li&gt;
&lt;li&gt;SPI kernel module to be loaded by default?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;再起動。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo reboot
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;spi_bcm2835 がロードされていることを確認&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ lsmod | grep spi
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;SPI通信に必要なPythonライブラリをインストール。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo apt-get install python-pip
$ sudo pip install spidev
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;ブレッドボード配線&#34;&gt;ブレッドボード配線&lt;/h1&gt;

&lt;p&gt;&lt;img src=&#34;https://gurimusan.github.io/blog/img/20160930_raspberry_pi_how_to_measuring_temperature_using_adc/breadboard.jpg&#34; alt=&#34;ブレッドボードの配線&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;温度センサ-mcp9700-の配線&#34;&gt;温度センサ MCP9700 の配線&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://akizukidenshi.com/download/MCP9701-ETO.pdf&#34;&gt;データシート1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://akizukidenshi.com/download/mcp9700.pdf&#34;&gt;データシート2&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;VDD -&amp;gt; Raspberry Pi 3.3V&lt;/li&gt;
&lt;li&gt;VOUT -&amp;gt; VOUT -&amp;gt; MCP3008 CH0&lt;/li&gt;
&lt;li&gt;GND -&amp;gt; Raspberry Pi GND&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;mcp3008の配線&#34;&gt;MCP3008の配線&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://akizukidenshi.com/download/ds/microchip/mcp3008.pdf&#34;&gt;データシート&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;MCP3008 VDD -&amp;gt; Raspberry PI 3.3V&lt;/li&gt;
&lt;li&gt;MCP3008 VREF -&amp;gt; Raspberry PI 3.3V&lt;/li&gt;
&lt;li&gt;MCP3008 AGND -&amp;gt; Raspberry PI GND&lt;/li&gt;
&lt;li&gt;MCP3008 CLK -&amp;gt; Raspberry PI GPIO 11 (SCLK)&lt;/li&gt;
&lt;li&gt;MCP3008 DOUT -&amp;gt; Raspberry PI GPIO 9 (MISO)&lt;/li&gt;
&lt;li&gt;MCP3008 DIN -&amp;gt; Raspberry PI GPIO 10 (MOSI)&lt;/li&gt;
&lt;li&gt;MCP3008 CS/SHDN -&amp;gt; Raspberry PI GPIP 8 (CE0)&lt;/li&gt;
&lt;li&gt;MCP3008 DGND -&amp;gt; Raspberry PI GND&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;スクリプト&#34;&gt;スクリプト&lt;/h1&gt;

&lt;p&gt;下記を adc_tmp36.py というファイル名で保存。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# -*- coding: utf-8 -*-

import sys

import time

import spidev

spi = spidev.SpiDev()
spi.open(0,0)


def analog_read(channel):
    r = spi.xfer2([1, (8 + channel) &amp;lt;&amp;lt; 4, 0])
    adc_out = ((r[1]&amp;amp;3) &amp;lt;&amp;lt; 8) + r[2]
    return adc_out


if __name__ == &#39;__main__&#39;:
    try:
        while True:
            reading = analog_read(0)
            voltage = reading * 3.3 / 1024
            temp_c = voltage * 100 - 50
            print(&amp;quot;Volts V=%f\tTemp C=%f&amp;quot; % (voltage, temp_c))
            time.sleep(1)
    except KeyboardInterrupt:
        pass
    finally:
        spi.close()

    sys.exit(0)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;実行すると下記ように出力される。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ python adc_tmp36.py
Volts V=0.802441    Temp C=30.244141
Volts V=0.783105    Temp C=28.310547
Volts V=0.795996    Temp C=29.599609
Volts V=0.799219    Temp C=29.921875
Volts V=0.799219    Temp C=29.921875
Volts V=0.799219    Temp C=29.921875
Volts V=0.799219    Temp C=29.921875
Volts V=0.799219    Temp C=29.921875
Volts V=0.802441    Temp C=30.244141
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;室温は25℃くらいだが、高く表示される。&lt;/p&gt;

&lt;p&gt;精度は ±4℃ らしいので、その誤差の範囲なのか？&lt;/p&gt;

&lt;h1 id=&#34;スクリプトの説明&#34;&gt;スクリプトの説明&lt;/h1&gt;

&lt;h2 id=&#34;analog-read&#34;&gt;analog_read&lt;/h2&gt;

&lt;p&gt;MCP3008の特定のチャネルへの送受信のやりとりをする関数。&lt;/p&gt;

&lt;p&gt;CP3008のデータシートを見ると、MCP3008への送受信を行う方法が記載されている。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://gurimusan.github.io/blog/img/20160930_raspberry_pi_how_to_measuring_temperature_using_adc/mcp3008_spi_communication.png&#34; alt=&#34;CP3008の入力値と返り値&#34; /&gt;&lt;/p&gt;

&lt;p&gt;送信データは、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;00000001 1xxx0000 00000000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;のような24bitのデータとなる。&lt;/p&gt;

&lt;p&gt;最初の 00000001 はスタートビット。&lt;/p&gt;

&lt;p&gt;1xxx は 読み込みたいチャネルのよって変わる。&lt;/p&gt;

&lt;p&gt;例えば、&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ch 0 なら 1000&lt;/li&gt;
&lt;li&gt;ch 1 なら 1001&lt;/li&gt;
&lt;li&gt;ch 2 なら 1010&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;のようになる。&lt;/p&gt;

&lt;p&gt;プログラムコードに戻ると、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;r = spi.xfer2([1, (8 + channel) &amp;lt;&amp;lt; 4, 0])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;という処理では、xfer2という関数に3つの値を格納した配列を渡しているが、これが上記の24bitの送信データを表している。&lt;/p&gt;

&lt;p&gt;つまり、xfer2という関数に渡している配列のうち&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;最初の要素は 1 は 00000001 を表す&lt;/li&gt;
&lt;li&gt;2番目の要素の (8 + channel) &amp;lt;&amp;lt; 4 は 1xxx0000 を表す&lt;/li&gt;
&lt;li&gt;3癌目の要素は 00000000 を表す&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;xfer2からの返り値は&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[0, 0, 246]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;のようなデータが返却される。&lt;/p&gt;

&lt;p&gt;これも入力値と同様に24bitのデータを表す。&lt;/p&gt;

&lt;p&gt;MCP3008からの受信データは、下位10bitがチャネルへ入力されたデータとなるため、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;adc_out = ((r[1]&amp;amp;3) &amp;lt;&amp;lt; 8) + r[2]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;という処理は、xfer2から返却された配列の&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;2番目の要素と3、00000011との論理積を取ることで、下位2bitを取得する&lt;/li&gt;
&lt;li&gt;2番目の要素の下位2bitを8bit左にシフトして、3番目の要素との論理和をとることで、受信データの下位10bitが取得する&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;最後に、取得した下位10bitのデータを返却する。&lt;/p&gt;

&lt;h2 id=&#34;main&#34;&gt;main&lt;/h2&gt;

&lt;p&gt;ここで行っている処理は、下記のとおり。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;analog_read関数を実行して、MCP3008のch 0のデータを読み取り、受信データの下位10bitを取得する&lt;/li&gt;
&lt;li&gt;analog_read関数の返り値を電圧に変換する&lt;/li&gt;
&lt;li&gt;電圧を温度（摂氏）に変換する&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;電圧への変換方法は、MCP3008のEQUATION 4-2を見ると、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;out = (1024 * Vin) / Vref
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;と記述があるので&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Vin = (out * Vref) / 1024
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、MCP3008からの受信データからMPC9700から出力された電圧が求まる。&lt;/p&gt;

&lt;p&gt;MPC9700のデータシートの4.0 活用情報」を見るとセンサーの変換関数が記載されている。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Vout = Tc1 * Ta + V0c

Ta = 周囲温度
Vout = センサー出力電圧
V0c = 0℃の時のセンサーの出力電圧(500mV)
Tc1 = 温度係数(10mV)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;なので&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Ta = Vout / Tc1 - V0c
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、温度が求まる。&lt;/p&gt;

&lt;h1 id=&#34;参考にしたサイト&#34;&gt;参考にしたサイト&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://qiita.com/masato/items/f089a17b1c9329eb7d03&#34;&gt;Raspberry PiのPythonからTMP36のアナログ温度センサとMCP3008のADコンバータを使う&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://pongsuke.hatenablog.com/entry/2016/01/08/111937&#34;&gt;温度センサーを試す&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://elinux.org/RPi_Low-level_peripherals#Model_A.2B.2C_B.2B_and_B2&#34;&gt;Raspberry PI のピン配置&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>